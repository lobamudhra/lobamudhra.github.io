<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/9f8c21078d4d48f3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9f8c21078d4d48f3.css" data-n-g=""/><link rel="preload" href="/_next/static/css/85fdc14739e57ee1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/85fdc14739e57ee1.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-a772cb4e65071da0.js" defer=""></script><script src="/_next/static/chunks/framework-ae4f43955bfa5ddc.js" defer=""></script><script src="/_next/static/chunks/main-3cf1b4d0a841b0b4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-190aa21c2c3f601a.js" defer=""></script><script src="/_next/static/chunks/734-501744163e7117ce.js" defer=""></script><script src="/_next/static/chunks/428-3b4801b92e87da41.js" defer=""></script><script src="/_next/static/chunks/637-485e8fd7a429178a.js" defer=""></script><script src="/_next/static/chunks/274-8c280538e303b201.js" defer=""></script><script src="/_next/static/chunks/pages/courses/spring-security/lessons/verify-token-0cea12737e5b1bcd.js" defer=""></script><script src="/_next/static/jrh1wZfexw-7t3We4dymB/_buildManifest.js" defer=""></script><script src="/_next/static/jrh1wZfexw-7t3We4dymB/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/icon?family=Material+Icons">@font-face{font-family:'Material Icons';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/materialicons/v139/flUhRq6tzZclQEJ-Vdg-IuiaDsNa.woff) format('woff')}.material-icons{font-family:'Material Icons';font-weight:normal;font-style:normal;font-size:24px;line-height:1;letter-spacing:normal;text-transform:none;display:inline-block;white-space:nowrap;word-wrap:normal;direction:ltr;font-feature-settings:'liga'}@font-face{font-family:'Material Icons';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/materialicons/v139/flUhRq6tzZclQEJ-Vdg-IuiaDsNcIhQ8tQ.woff2) format('woff2')}.material-icons{font-family:'Material Icons';font-weight:normal;font-style:normal;font-size:24px;line-height:1;letter-spacing:normal;text-transform:none;display:inline-block;white-space:nowrap;word-wrap:normal;direction:ltr;-webkit-font-feature-settings:'liga';-webkit-font-smoothing:antialiased}</style></head><body><div id="__next"><header class="header_header___GOuZ sticky-top"><div class="container"><div class="logo_logo__RXjG7 cursor-pointer text-white py-2"><div class="hstack"><div class="logo_acronym__FiNtE">FC</div><div class="vr"></div><div><div>FACADE</div><div>CODE</div></div></div></div></div></header><main class="my-3"><div class="container"><section class="header_lessonHeader__jhqot"><div class="float-start">Lesson <!-- -->24<!-- --> of <!-- -->28</div><div class="float-end"><a href="javascript:void(0)" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">Spring Security</a></div></section><div class="clearfix"></div><section><div class="offcanvas offcanvas-end" data-bs-scroll="true" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel"><div class="offcanvas-header border-bottom p-0 px-3 header_active__mLmmf"><div class="logo_logo__RXjG7 cursor-pointer text-white py-2"><div class="hstack"><div class="logo_acronym__FiNtE">FC</div><div class="vr"></div><div><div>FACADE</div><div>CODE</div></div></div></div><button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" data-bs-target="#offcanvasRight" aria-label="Close"></button></div><div class="offcanvas-body p-0"><h1 class="fw-light text-center m-3">Spring Security</h1><h3 class="fs-3 text-center text-muted m-3">Contents</h3><section><div class="list-group list-group-flush"><div class="list-group-item fs-5 text-bg-light border-bottom"><span style="color:cornflowerblue">01. Bootstrap The Application</span></div><div class="list-group list-group-flush"><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">1<!-- -->. <!-- -->Introduction</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">2<!-- -->. <!-- -->Install Spring Security</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">3<!-- -->. <!-- -->Enable Basic Auth</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">4<!-- -->. <!-- -->Authentication with AppUser</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">5<!-- -->. <!-- -->Password Encoder</span></div></div><div class="list-group-item fs-5 text-bg-light border-bottom"><span style="color:cornflowerblue">02. Web Layer Security - RBAC</span></div><div class="list-group list-group-flush"><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">6<!-- -->. <!-- -->Permit Public APIs</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">7<!-- -->. <!-- -->Role Based Authorization</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">8<!-- -->. <!-- -->Disable CSRF</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">9<!-- -->. <!-- -->Current Authenticated User</span></div></div><div class="list-group-item fs-5 text-bg-light border-bottom"><span style="color:cornflowerblue">03. Web Layer Security - PBAC</span></div><div class="list-group list-group-flush"><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">10<!-- -->. <!-- -->Permission Based Authorization</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">11<!-- -->. <!-- -->Define Permissions</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">12<!-- -->. <!-- -->Assign Permissions</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">13<!-- -->. <!-- -->Remove Role Based Access</span></div></div><div class="list-group-item fs-5 text-bg-light border-bottom"><span style="color:cornflowerblue">04. Service Layer Security</span></div><div class="list-group list-group-flush"><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">14<!-- -->. <!-- -->PreAuthorize</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">15<!-- -->. <!-- -->PostAuthorize</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">16<!-- -->. <!-- -->Authorize Using Spring Beans</span></div></div><div class="list-group-item fs-5 text-bg-light border-bottom"><span style="color:cornflowerblue">05. Domain Object Instance Security</span></div><div class="list-group list-group-flush"><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">17<!-- -->. <!-- -->Domain Object Instance Security</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">18<!-- -->. <!-- -->PermissionEvaluator Interface</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">19<!-- -->. <!-- -->PermissionEvaluator Strategy</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">20<!-- -->. <!-- -->DB Backed UserDetailsService</span></div></div><div class="list-group-item fs-5 text-bg-light border-bottom"><span style="color:cornflowerblue">06. Token Based Authentication</span></div><div class="list-group list-group-flush"><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">21<!-- -->. <!-- -->Basic Authentication Revisited</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">22<!-- -->. <!-- -->Generate Token</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">23<!-- -->. <!-- -->Persist Token</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6 Contents_active__vP5PJ"><span class="px-4">24<!-- -->. <!-- -->Verify Token</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">25<!-- -->. <!-- -->Invalidate Token</span></div></div><div class="list-group-item fs-5 text-bg-light border-bottom"><span style="color:cornflowerblue">07. Token Based Authentication and Authorization</span></div><div class="list-group list-group-flush"><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">26<!-- -->. <!-- -->JSON Web Token</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">27<!-- -->. <!-- -->Generate JWT</span></div><div class="list-group-item list-group-item-action cursor-pointer border-0 p-2 fs-6"><span class="px-4">28<!-- -->. <!-- -->Verify JWT</span></div></div></div></section></div></div></section><div class="mt-5"><div class="float-end"><a href="/assets/patches/spring-security/verify-token.patch" target="_blank" class="icon-link" data-bs-toggle="tooltip" data-bs-title="Download patch"><i class="bi-download fs-5 mx-2 cursor-pointer"></i></a><a href="https://github.com/facade-code/spring-security-for-developers/tree/verify-token" target="_blank" class="icon-link" data-bs-toggle="tooltip" data-bs-title="Github repository"><i class="bi-github fs-5 mx-2 cursor-pointer"></i></a><a href="javascript:void(0)" class="icon-link" data-bs-toggle="tooltip" data-bs-title="Copy link"><i class="bi-link-45deg fs-5 mx-2 cursor-pointer"></i></a></div><div class="clearfix"></div></div><section><h1 class="display-5 mt-2 mb-2">Verify Token</h1><p class="Heading_underline__sSwtx"></p><p class="Paragraph_paragraph__90U8D">Assume we have a Single Page Application (SPA) calling our <u>GenerateToken</u> API on behalf of the user with the username and password provided by the user himself. Once the API authenticates and issues the token, the SPA will store the token somewhere to send it back in subsequent requests as a Bearer token in the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">Authorization</mark> header in the format <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">Bearer &lt;TOKEN&gt;</mark>.</p><p class="Paragraph_paragraph__90U8D">Bearer token is a security token similar to cash, whoever possess the token can use it in any way the token is intended for. Using a bearer token does not require a bearer to prove the possession of the token. So it must be stored securely and transferred over a secure network.</p></section><section><h3 class="fw-light mt-5 mb-2">Find user by token</h3><p class="Paragraph_paragraph__90U8D">In order to verify the token, we need to identify the user associated with the token as well as ensure the token is not expired. So we will find the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">AppUser</mark> by <em>token</em> and <em>tokenExpiryTime</em> greater than the current time using standard Spring Data JPA method in AppUserRepository.</p><div class="border rounded fs-6 my-4"><div class="p-3 bg-light border-bottom"><span class="font-monospace"><a href="https://github.com/facade-code/spring-security-for-developers/blob/verify-token/src/main/java/com/facadecode/spring/security/repo/AppUserRepository.java" target="_blank">AppUserRepository.java</a></span><span class="float-end cursor-pointer" data-bs-toggle="tooltip" data-bs-title="Copy code"><i class="bi-clipboard"></i></span></div><pre class="m-0 px-3 pb-3"><code class="language-java"><span>
<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AppUserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;AppUser, Long&gt; {
    <span class="hljs-comment">// Other methods omitted for brevity</span>
    Optional&lt;AppUser&gt; <span class="hljs-title function_">findByTokenAndTokenExpiryTimeGreaterThan</span><span class="hljs-params">(String token, Date currentDate)</span>;
}
</span></code></pre></div><p class="Paragraph_paragraph__90U8D">Similar to <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">loadUserByUsername()</mark> we will implement a method in <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">DbUserDetailsService</mark> to call the above repository method and return the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">UserDetails</mark> object mapped from the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">AppUser</mark> record. By passing current time along with token we ensure that the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">AppUser</mark> record returned is not only matching the <em>token</em> but also it&#x27;s <em>tokenExpiryTime</em> is always greater than the current time.</p><div class="border rounded fs-6 my-4"><div class="p-3 bg-light border-bottom"><span class="font-monospace"><a href="https://github.com/facade-code/spring-security-for-developers/blob/verify-token/src/main/java/com/facadecode/spring/security/service/DbUserDetailsService.java" target="_blank">DbUserDetailsService.java</a></span><span class="float-end cursor-pointer" data-bs-toggle="tooltip" data-bs-title="Copy code"><i class="bi-clipboard"></i></span></div><pre class="m-0 px-3 pb-3"><code class="language-java"><span>
<span class="hljs-keyword">public</span> UserDetails <span class="hljs-title function_">loadUserByToken</span><span class="hljs-params">(String token)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException {
    <span class="hljs-type">AppUser</span> <span class="hljs-variable">appUser</span> <span class="hljs-operator">=</span> appUserRepository.findByTokenAndTokenExpiryTimeGreaterThan(token, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>())
            .orElseThrow(() -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadCredentialsException</span>(<span class="hljs-string">&quot;Provided token is either expired or not found&quot;</span>));

    <span class="hljs-keyword">return</span> User.builder()
        .username(appUser.getUsername())
        .password(appUser.getPassword())
        .authorities(<span class="hljs-built_in">this</span>.getPermissions(appUser.getRoles()))
        .build();
}
</span></code></pre></div></section><section><h3 class="fw-light mt-5 mb-2">TokenVerificationFilter</h3><p class="Paragraph_paragraph__90U8D">Before the request reaches the endpoint we have to intercept the request and authenticate the user by the token extracted from the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">Authorization</mark> header. This can be done using standard Spring filter extending <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">OncePerRequestFilter</mark>. Let&#x27;s create the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">TokenVerficiationFilter</mark> component in order to perform the steps mentioned in the comments.</p><div class="border rounded fs-6 my-4"><div class="p-3 bg-light border-bottom"><span class="font-monospace"><a href="https://github.com/facade-code/spring-security-for-developers/blob/verify-token/src/main/java/com/facadecode/spring/security/filters/TokenVerificationFilter.java" target="_blank">TokenVerficationFilter.java</a></span><span class="float-end cursor-pointer" data-bs-toggle="tooltip" data-bs-title="Copy code"><i class="bi-clipboard"></i></span></div><pre class="m-0 px-3 pb-3"><code class="language-java"><span>
<span class="hljs-meta">@Component</span>  
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TokenVerificationFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OncePerRequestFilter</span> {
    <span class="hljs-meta">@Override</span>  
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilterInternal</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> ServletException, IOException {
        <span class="hljs-comment">// Extract the token from the Authorization header</span>
        <span class="hljs-comment">// Identify the user by token using the above loadUserByToken() service method</span>
        <span class="hljs-comment">// Create Authentication object as authenticated principal</span>
        <span class="hljs-comment">// Set Authentication in SecurityContext</span>
        filterChain.doFilter(request, response);
    }
}
</span></code></pre></div><p class="Paragraph_paragraph__90U8D">The format of the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">Authorization</mark> header value will be <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">Bearer &lt;TOKEN&gt;</mark>, so we have to remove the prefix <em>Bearer</em> (with a whitespace) to get only the token value. We will use the token to find the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">UserDetails</mark> object from the above <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">loadUserByToken()</mark> service method.</p><p class="Paragraph_paragraph__90U8D">Remember we have used <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">UsernamePasswordAuthenticationToken</mark> in <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">generateToken()</mark> service in order to create <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">Authentication</mark> object as an authentication request using <em>username</em> and <em>password</em>. Here we are using the same to create <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">Authentication</mark> object as an authenticated principal using <em>username</em> and his <em>authorities</em> retrieved from the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">UserDetails</mark> object. We will then set it in <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">SecurityContext</mark> by ourselves to make it available through out the request in order to authorize the user at various layers.</p><div class="border rounded fs-6 my-4"><div class="p-3 bg-light border-bottom"><span class="font-monospace"><a href="https://github.com/facade-code/spring-security-for-developers/blob/verify-token/src/main/java/com/facadecode/spring/security/filters/TokenVerificationFilter.java" target="_blank">TokenVerificationFilter.java</a></span><span class="float-end cursor-pointer" data-bs-toggle="tooltip" data-bs-title="Copy code"><i class="bi-clipboard"></i></span></div><pre class="m-0 px-3 pb-3"><code class="language-java"><span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TokenVerificationFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OncePerRequestFilter</span> {
    <span class="hljs-comment">// Other details omitted for brevity</span>

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilterInternal</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> ServletException, IOException {
        <span class="hljs-comment">// Extract the token from the Authorization header</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">authorizationHeader</span> <span class="hljs-operator">=</span> request.getHeader(HttpHeaders.AUTHORIZATION);

        <span class="hljs-keyword">if</span> (authorizationHeader != <span class="hljs-literal">null</span> &amp;&amp; authorizationHeader.startsWith(<span class="hljs-string">&quot;Bearer &quot;</span>)) {
            <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> authorizationHeader.replace(<span class="hljs-string">&quot;Bearer &quot;</span>, <span class="hljs-string">&quot;&quot;</span>);
            <span class="hljs-comment">// Identify the user by token using the above loadUserByToken() service method</span>
            <span class="hljs-type">UserDetails</span> <span class="hljs-variable">userDetails</span> <span class="hljs-operator">=</span> userDetailsService.loadUserByToken(token);

            <span class="hljs-keyword">if</span> (userDetails != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// Create Authentication object as authenticated principal</span>
                <span class="hljs-type">Authentication</span> <span class="hljs-variable">authentication</span> <span class="hljs-operator">=</span> UsernamePasswordAuthenticationToken.authenticated(
                        userDetails.getUsername(), <span class="hljs-literal">null</span>, userDetails.getAuthorities()
                );
                <span class="hljs-comment">// Set Authentication in SecurityContext</span>
                authenticationFacade.setAuthentication(authentication);
            }
        }

        filterChain.doFilter(request, response);
    }
}
</span></code></pre></div></section><section><h3 class="fw-light mt-5 mb-2">Configure TokenVerficiationFilter</h3><p class="Paragraph_paragraph__90U8D">Finally let&#x27;s configure <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">TokenVerficiationFilter</mark> in <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">HttpSecurity</mark> configuration to let all the requests pass through it before attempting to authenticate the user with <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">UsernamePasswordAuthenticationFilter</mark>.</p><div class="border rounded fs-6 my-4"><div class="p-3 bg-light border-bottom"><span class="font-monospace"><a href="https://github.com/facade-code/spring-security-for-developers/blob/verify-token/src/main/java/com/facadecode/spring/security/config/ApiSecurityConfig.java" target="_blank">ApiSecurityConfig.java</a></span><span class="float-end cursor-pointer" data-bs-toggle="tooltip" data-bs-title="Copy code"><i class="bi-clipboard"></i></span></div><pre class="m-0 px-3 pb-3"><code class="language-java"><span>
<span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> SecurityFilterChain <span class="hljs-title function_">apiFilterChain</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception {
    http
        .csrf().disable()
        .addFilterBefore(tokenVerificationFilter, UsernamePasswordAuthenticationFilter.class)
        .sessionManagement(
            httpSecuritySessionManagementConfigurer -&gt;
                    httpSecuritySessionManagementConfigurer.sessionCreationPolicy(SessionCreationPolicy.STATELESS)
        )
        .authorizeRequests(auth -&gt; auth
            .antMatchers(POST, API_AUTH_TOKEN).permitAll()
            .antMatchers(GET, PUBLIC_API_LIST).permitAll()
            .anyRequest().authenticated()
        );
    <span class="hljs-keyword">return</span> http.build();
}
</span></code></pre></div><p class="Paragraph_paragraph__90U8D">Restart the application and get the token generated for <em>Admin</em> user credentials by sending a POST request to <u>GenerateToken</u> API.</p><div class="p-3"><div class="mb-3 text-secondary text-center"><em>UUID token generated for Admin user credentials on successful authentication</em></div><img class="img-fluid rounded border shadow" src="/assets/images/spring-security/lesson24-01.png" alt="UUID token generated for Admin user credentials on successful authentication"/></div><p class="Paragraph_paragraph__90U8D">Now choose the Authorization type as <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">Bearer Token</mark>, and paste the generated token in the Token Field. If we send a GET request to <u>ListStudents</u> API with the Bearer Token set in the Authorization header, the request will be intercepted by <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">TokenVerificationFilter</mark> to authenticate the request by the token. Once the authentication is success the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">Authentication</mark> object is set in <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">SecurityContext</mark> for Spring Security to authorize the user in the appropriate layers. And we will get the response back for the authorized user request like below:</p><div class="p-3"><div class="mb-3 text-secondary text-center"><em>List of students response for the authorized token issed for Admin user</em></div><img class="img-fluid rounded border shadow" src="/assets/images/spring-security/lesson24-02.png" alt="List of students response for the authorized token issed for Admin user"/></div><p class="Paragraph_paragraph__90U8D">Similarly you can test the same for different users and their authorized actions. You can also use the token after it&#x27;s expiry time to see <em>403 Forbidden</em> error which then requires you to re-authenticate the user to generate a new token.</p></section><div class="mt-5"><section><div class="row border-top border-bottom py-2 mt-2"><div class="col-12 col-md-6 col-lg-6 text-center text-md-start"><div><div class="text-muted"><i class="bi-arrow-left-short mx-1 align-middle invisible d-none d-md-inline-block"></i>Previous</div><div><i class="bi-arrow-left-short mx-1 align-middle footer_icon__J1tGG"></i><a href="/courses/spring-security/lessons/persist-token">Persist Token</a></div></div></div><div class="col-12 col-md-6 col-lg-6 text-center text-md-end"><div><div class="text-muted">Next<i class="bi-arrow-right-short mx-1 align-middle invisible d-none d-md-inline-block"></i></div><div><a href="/courses/spring-security/lessons/invalidate-token">Invalidate Token</a><i class="bi-arrow-right-short mx-1 align-middle footer_icon__J1tGG"></i></div></div></div></div></section></div></div></main><footer class="footer_footer__0KXQq"><div class="mt-5 py-5 text-center fw-lighter text-light bg-secondary"><div class="container"><figure><blockquote class="blockquote">I’m not a great programmer; I’m just a good programmer with great habits</blockquote><figcaption class="blockquote-footer text-light">Kent Beck</figcaption></figure></div></div><div class="bg-dark"><div class="py-5"><div class="container"><div class="row"><div class="col-12 col-md-6 m-3 m-md-0"><div class="logo_logo__RXjG7 cursor-pointer text-white py-2"><div class="hstack"><div class="logo_acronym__FiNtE">FC</div><div class="vr"></div><div><div>FACADE</div><div>CODE</div></div></div></div><div class="logo_logoCaption__h__G1">Simple bite-sized lessons to learn complex concepts</div></div><div class="col-12 col-md-3 m-3 m-md-0"><a href="/aboutme" class="footer_home__36kMG"><strong>ABOUT ME</strong></a></div><div class="col-12 col-md-3 m-3 m-md-0"><strong>COURSES</strong><ul class="list-unstyled p-0"><li class="my-2"><a href="/courses/spring-security">Spring Security</a></li></ul></div></div></div></div><div class="text-center py-2 footer_copyright__mlBDD">Copyright © 2022 FacadeCode</div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/courses/spring-security/lessons/verify-token","query":{},"buildId":"jrh1wZfexw-7t3We4dymB","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>