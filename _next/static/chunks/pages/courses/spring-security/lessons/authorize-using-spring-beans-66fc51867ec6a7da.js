(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[133],{7180:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/courses/spring-security/lessons/authorize-using-spring-beans",function(){return c(4759)}])},476:function(d,b,a){"use strict";var e=a(7568),c=a(4051),f=a.n(c),g=a(5893),h=a(637),i=a(7294),j=a(1896);b.Z=function(a){var l,b=a.fileName,m=a.href,c=a.language,d=void 0===c?"java":c,n=a.children,k=(0,i.useState)(!1),o=k[0],q=k[1],p=(l=(0,e.Z)(f().mark(function a(){return f().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,navigator.clipboard.writeText(n);case 2:q(!0),setTimeout(function(){return q(!1)},6e3);case 4:case"end":return a.stop()}},a)})),function(){return l.apply(this,arguments)});return(0,g.jsxs)("div",{className:"border rounded fs-6 my-4",children:[b&&(0,g.jsxs)("div",{className:"p-3 bg-light border-bottom",children:[(0,g.jsx)("span",{className:"font-monospace",children:(0,g.jsx)("a",{href:m,target:"_blank",children:b})}),(0,g.jsx)("span",{className:"float-end cursor-pointer","data-bs-toggle":"tooltip","data-bs-title":"Copy code",onClick:p,children:(0,g.jsx)("i",{className:"bi-clipboard"})})]}),(0,g.jsx)("pre",{className:"m-0 px-3 pb-3",children:(0,g.jsx)("code",{className:"language-".concat(d),children:(0,g.jsx)("span",{dangerouslySetInnerHTML:{__html:h.Z.highlight(n,{language:d}).value}})})}),o&&(0,g.jsx)(j.Z,{children:"Code copied to clipboard"})]})}},9963:function(d,b,a){"use strict";a.d(b,{aC:function(){return h},k8:function(){return i},nL:function(){return g}});var e=a(5893),c=a(4046),f=a.n(c);function g(a){var b=a.children;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("h1",{className:"display-5 mt-2 mb-2",children:b}),(0,e.jsx)("p",{className:f().underline})]})}function h(a){var b=a.children;return(0,e.jsx)("h3",{className:"fw-light mt-5 mb-2",children:b})}function i(a){var b=a.children;return(0,e.jsx)("h4",{className:"fw-light mt-5 mb-2",children:b})}},4621:function(c,a,b){"use strict";var d=b(5893);a.Z=function(a){var c=a.src,b=a.title;return(0,d.jsxs)("div",{className:"p-3",children:[(0,d.jsx)("div",{className:"mb-3 text-secondary text-center",children:(0,d.jsx)("em",{children:b})}),(0,d.jsx)("img",{className:"img-fluid rounded border shadow",src:c,alt:b})]})}},7291:function(d,b,a){"use strict";var e=a(5893),c=a(9472),f=a.n(c);b.Z=function(a){var b=a.children;return(0,e.jsx)("mark",{className:"font-monospace border rounded p-1 ".concat(f().mark),children:b})}},3968:function(d,b,a){"use strict";var e=a(5893),c=a(3394),f=a.n(c);b.Z=function(a){var b=a.title,c=a.children;return(0,e.jsxs)("section",{className:"px-3 pt-1 my-5 ".concat(f().notes),children:[(0,e.jsxs)("h4",{className:"mb-3",children:[(0,e.jsx)("i",{className:"bi bi-info-circle me-2"}),void 0===b?"Note":b]}),c]})}},4759:function(f,b,a){"use strict";a.r(b);var g=a(5893),h=a(9963),i=a(130),j=a(7291),k=a(476),l=a(4621),c=a(3274),d=a(9927),e=a(358);a(3968),b.default=(0,c.default)(function(b){var a=b.githubPath;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("section",{children:[(0,g.jsx)(h.nL,{children:"Authorize Using Spring Beans"}),(0,g.jsx)(i.Z,{children:"Simple authorization rules can be written using SpEL expressions inside Method security annotations. But there can be rules which are quite harder to write in SpEL, where the expression itself could be better off reside in its own method rather than as a complex String constant."})]}),(0,g.jsxs)("section",{children:[(0,g.jsx)(h.aC,{children:"Make Instructor's profile public"}),(0,g.jsxs)(i.Z,{children:["Let's extend the ",(0,g.jsx)("u",{children:"ViewProfile"})," usecase to make Instructor's profiles public in addition to viewing one's own profile. This can only be done by checking if the requested user profile has Instructor role something like below."]}),(0,g.jsx)(k.Z,{children:"\nappuser.getRoles()\n    .stream()\n    .anyMatch(appRole ->\n            appRole.getName().equals(RoleEnum.INSTRUCTOR)\n    );\n"}),(0,g.jsxs)(i.Z,{children:["Is there any simpler way to implement this in SpEL expressions? Well, we can do this using ",(0,g.jsx)("strong",{children:"Spring Beans"}),". Let's define a Spring Bean ",(0,g.jsx)(j.Z,{children:"@Component"})," to hold a collection of helper methods which can be used to secure your Service layer."]}),(0,g.jsx)(k.Z,{fileName:"ServiceSecurity.java",href:a+"/src/main/java/com/facadecode/spring/security/security/ServiceSecurity.java",children:'\n@Component("serviceSecurity")  \npublic class ServiceSecurity {\n    public Boolean isInstructor(AppUser appUser) {\n      appuser.getRoles()\n          .stream()\n          .anyMatch(appRole ->\n                  appRole.getName().equals(RoleEnum.INSTRUCTOR)\n          );\n    }\n}\n'}),(0,g.jsxs)(i.Z,{children:["We can call the above Bean method with the requested user profile as the argument. We can refer the Bean component using it's name prefixed with ",(0,g.jsx)("strong",{children:"@"})," [@serviceSecurity] and we can access the requested user profile from ",(0,g.jsx)(j.Z,{children:"returnObject"})," inside ",(0,g.jsx)(j.Z,{children:"@PostAuthorize()"}),". We should combine it with the existing condition with an ",(0,g.jsx)(j.Z,{children:"or"})," condition like below."]}),(0,g.jsx)(k.Z,{fileName:"UserService.java",href:a+"/src/main/java/com/facadecode/spring/security/service/UserService.java",children:'\n@PreAuthorize(Authority.VIEW_PROFILE)\n@PostAuthorize("@serviceSecurity.isInstructor(returnObject) or returnObject.username == authentication.name")\npublic AppUser get(Long userId) {\n    ...\n}\n'}),(0,g.jsxs)(i.Z,{children:["Let's send the last unauthorized request again to view Gru's user profile using ",(0,g.jsx)("em",{children:"Bob"}),"'s credential. We can view the Instructor's profile this time."]}),(0,g.jsx)(l.Z,{src:"/assets/images/spring-security/lesson16-01.png",title:"Authorized request to view Gru (Instructor) profile with Bob's credential"})]})]})},(0,e.s)(d.Z,"authorize-using-spring-beans"))},4046:function(a){a.exports={heading:"Heading_heading__aP_DN",underline:"Heading_underline__sSwtx"}},9472:function(a){a.exports={mark:"Mark_mark__8gh_T"}},3394:function(a){a.exports={notes:"Notes_notes__up3CK"}}},function(a){a.O(0,[734,428,637,274,774,888,179],function(){var b;return a(a.s=7180)}),_N_E=a.O()}])