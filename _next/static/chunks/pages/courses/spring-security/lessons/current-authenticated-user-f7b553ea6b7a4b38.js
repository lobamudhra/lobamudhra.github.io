(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[552],{1767:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/courses/spring-security/lessons/current-authenticated-user",function(){return c(1135)}])},476:function(d,b,a){"use strict";var e=a(7568),c=a(4051),f=a.n(c),g=a(5893),h=a(637),i=a(7294),j=a(1896);b.Z=function(a){var l,b=a.fileName,m=a.href,c=a.language,d=void 0===c?"java":c,n=a.children,k=(0,i.useState)(!1),o=k[0],q=k[1],p=(l=(0,e.Z)(f().mark(function a(){return f().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,navigator.clipboard.writeText(n);case 2:q(!0),setTimeout(function(){return q(!1)},6e3);case 4:case"end":return a.stop()}},a)})),function(){return l.apply(this,arguments)});return(0,g.jsxs)("div",{className:"border rounded fs-6 my-4",children:[b&&(0,g.jsxs)("div",{className:"p-3 bg-light border-bottom",children:[(0,g.jsx)("span",{className:"font-monospace",children:(0,g.jsx)("a",{href:m,target:"_blank",children:b})}),(0,g.jsx)("span",{className:"float-end cursor-pointer","data-bs-toggle":"tooltip","data-bs-title":"Copy code",onClick:p,children:(0,g.jsx)("i",{className:"bi-clipboard"})})]}),(0,g.jsx)("pre",{className:"m-0 px-3 pb-3",children:(0,g.jsx)("code",{className:"language-".concat(d),children:(0,g.jsx)("span",{dangerouslySetInnerHTML:{__html:h.Z.highlight(n,{language:d}).value}})})}),o&&(0,g.jsx)(j.Z,{children:"Code copied to clipboard"})]})}},9963:function(d,b,a){"use strict";a.d(b,{aC:function(){return h},k8:function(){return i},nL:function(){return g}});var e=a(5893),c=a(4046),f=a.n(c);function g(a){var b=a.children;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("h1",{className:"display-5 mt-2 mb-2",children:b}),(0,e.jsx)("p",{className:f().underline})]})}function h(a){var b=a.children;return(0,e.jsx)("h3",{className:"fw-light mt-5 mb-2",children:b})}function i(a){var b=a.children;return(0,e.jsx)("h4",{className:"fw-light mt-5 mb-2",children:b})}},4621:function(c,a,b){"use strict";var d=b(5893);a.Z=function(a){var c=a.src,b=a.title;return(0,d.jsxs)("div",{className:"p-3",children:[(0,d.jsx)("div",{className:"mb-3 text-secondary text-center",children:(0,d.jsx)("em",{children:b})}),(0,d.jsx)("img",{className:"img-fluid rounded border shadow",src:c,alt:b})]})}},7291:function(d,b,a){"use strict";var e=a(5893),c=a(9472),f=a.n(c);b.Z=function(a){var b=a.children;return(0,e.jsx)("mark",{className:"font-monospace border rounded p-1 ".concat(f().mark),children:b})}},1135:function(f,b,a){"use strict";a.r(b);var g=a(5893),h=a(9963),i=a(130),j=a(7291),k=a(476),l=a(4621),c=a(3274),d=a(9927),e=a(358);b.default=(0,c.default)(function(b){var a=b.githubPath;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("section",{children:[(0,g.jsx)(h.nL,{children:"Current Authenticated User"}),(0,g.jsxs)(i.Z,{children:["In the last chapter, you might have noticed the value for ",(0,g.jsx)("em",{children:"createdBy"})," field is ",(0,g.jsx)("em",{children:"null"})," in the newly created Course object. Of course, we did not send the user details in the request body for the ",(0,g.jsx)("em",{children:"createdBy"})," field. As every request is authenticated, it makes sense to expect the requestor (Gru) details to get mapped automatically in the ",(0,g.jsx)("em",{children:"createdBy"})," field."]})]}),(0,g.jsxs)("section",{children:[(0,g.jsx)(h.aC,{children:"SecurityContextHolder"}),(0,g.jsxs)(i.Z,{children:["At the heart of Spring Security's authentication model is ",(0,g.jsx)(j.Z,{children:"SecurityContextHolder"}),". It contains ",(0,g.jsx)(j.Z,{children:"SecurityContext"})," holding the details of who is authenticated in the form of ",(0,g.jsx)(j.Z,{children:"Authentication"})," object. It uses ",(0,g.jsx)(j.Z,{children:"ThreadLocal"})," to store these details to make it available for all the methods in the same thread through out the request."]})]}),(0,g.jsxs)("section",{children:[(0,g.jsx)(h.aC,{children:"Authentication"}),(0,g.jsxs)(i.Z,{children:["Authentication represents the token for an authentication request or for an authenticated principal. Technically it serves as the input and output for the one and only ",(0,g.jsx)(j.Z,{children:"authenticate()"})," method in ",(0,g.jsx)(j.Z,{children:"AuthenticationManager"})," interface."]}),(0,g.jsx)(k.Z,{children:"\npublic interface AuthenticationManager {\n    Authentication authenticate(Authentication authentication)\n}\n"}),(0,g.jsxs)(i.Z,{children:["As an authentication request it carries the ",(0,g.jsx)("em",{children:"username"})," and ",(0,g.jsx)("em",{children:"password"})," provided by the user where the ",(0,g.jsx)("em",{children:"isAuthenticated"})," flag is set to false by default. Once the request has been processed by the ",(0,g.jsx)(j.Z,{children:"AuthenticationManager"})," it returns back the ",(0,g.jsx)(j.Z,{children:"Authentication"})," object as authenticated principal. As an authenticated principal it carries either the username or ",(0,g.jsx)(j.Z,{children:"UserDetails"})," and the collection of ",(0,g.jsx)(j.Z,{children:"GrantedAuthority"})," of the authenticated user where the ",(0,g.jsx)("em",{children:"isAuthenticated"})," flag is set to true."]}),(0,g.jsxs)(i.Z,{children:["Let's create a Facade component to get this ",(0,g.jsx)(j.Z,{children:"Authentication"})," object as an authenticated principal from ",(0,g.jsx)(j.Z,{children:"SecurityContextHolder"}),"."]}),(0,g.jsx)(k.Z,{fileName:"AuthenticationFacade.java",href:a+"/src/main/java/com/facadecode/spring/security/security/AuthenticationFacade.java",children:"\n@Component\npublic class AuthenticationFacade {\n    public Authentication getAuthentication() {\n        return SecurityContextHolder.getContext().getAuthentication();\n    }\n}\n"})]}),(0,g.jsxs)("section",{children:[(0,g.jsx)(h.aC,{children:"Find AppUser using Authentication object"}),(0,g.jsxs)(i.Z,{children:["As the variable type of ",(0,g.jsx)("em",{children:"createdBy"})," field in the ",(0,g.jsx)(j.Z,{children:"Course"})," entity is ",(0,g.jsx)(j.Z,{children:"AppUser"}),", we have to retrieve the ",(0,g.jsx)(j.Z,{children:"AppUser"})," record from the database using the username found in the ",(0,g.jsx)(j.Z,{children:"Authentication"})," object."]}),(0,g.jsxs)(i.Z,{children:["Let's define ",(0,g.jsx)(j.Z,{children:"findByUsername()"})," method in ",(0,g.jsx)(j.Z,{children:"AppUserRepository"})," interface."]}),(0,g.jsx)(k.Z,{fileName:"AppUserRepository.java",href:a+"/src/main/java/com/facadecode/spring/security/repo/AppUserRepository.java",children:"\n@Repository\npublic interface AppUserRepository extends JpaRepository<AppUser, Long> {\n    Optional<AppUser> findByUsername(String username);\n}\n"}),(0,g.jsxs)(i.Z,{children:["Add a service method in ",(0,g.jsx)(j.Z,{children:"UserService"})," to get the ",(0,g.jsx)(j.Z,{children:"AppUser"})," object by ",(0,g.jsx)("em",{children:"username"})," using the above method."]}),(0,g.jsx)(k.Z,{fileName:"UserService.java",href:a+"/src/main/java/com/facadecode/spring/security/service/UserService.java",children:"\npublic AppUser get(String username) {\n    return appUserRepository.findByUsername(username)\n            .orElse(null);\n}\n"})]}),(0,g.jsxs)("section",{children:[(0,g.jsx)(h.aC,{children:"Create course service"}),(0,g.jsxs)(i.Z,{children:["Now let's wire all the above pieces together in the ",(0,g.jsx)(j.Z,{children:"create()"})," service method defined in ",(0,g.jsx)(j.Z,{children:"CourseService"})," component, in order to update the ",(0,g.jsx)("em",{children:"createdBy"})," field with the ",(0,g.jsx)(j.Z,{children:"AppUser"})," object before saving the new Course."]}),(0,g.jsx)(k.Z,{fileName:"CourseService.java",href:a+"/src/main/java/com/facadecode/spring/security/service/CourseService.java",children:"\npublic Course create(Course newCourse) {\n    String username = authenticationFacade.getAuthentication().getName();\n    AppUser currentUser = userService.get(username);\n    newCourse.setCreatedBy(currentUser);\n    return courseRepo.save(newCourse);\n}\n"}),(0,g.jsxs)(i.Z,{children:["Restart the application and send a POST request to ",(0,g.jsx)("u",{children:"CreateCourse"})," API as Gru who has INSTRUCTOR role. And you can see the ",(0,g.jsx)("em",{children:"createdBy"})," field automatically saved with the requestor details even though we have not sent it as part of the request body."]}),(0,g.jsx)(l.Z,{src:"/assets/images/spring-security/lesson09-01.png",title:"Newly created course with createdBy field having the requestor details"})]})]})},(0,e.s)(d.Z,"current-authenticated-user"))},4046:function(a){a.exports={heading:"Heading_heading__aP_DN",underline:"Heading_underline__sSwtx"}},9472:function(a){a.exports={mark:"Mark_mark__8gh_T"}}},function(a){a.O(0,[734,428,637,274,774,888,179],function(){var b;return a(a.s=1767)}),_N_E=a.O()}])